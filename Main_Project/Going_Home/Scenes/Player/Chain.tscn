[gd_scene load_steps=5 format=2]

[ext_resource path="res://Assets/Grappling Hook/Tip.png" type="Texture" id=1]
[ext_resource path="res://Assets/Grappling Hook/Chain.png" type="Texture" id=2]

[sub_resource type="GDScript" id=2]
script/source = "extends Node2D

onready var links = $Links
var direction := Vector2(0,0)
var tip := Vector2(0,0)

const SPEED = 50

var flying = false
var hooked = false

func shoot(dir : Vector2) -> void:
	direction = dir.normalized()
	flying = true
	tip = self.global_position

func release() -> void:
	flying = false
	hooked = false
	
func _process(_delta : float) -> void:
	self.visible = flying or hooked
	if not self.visible:
		return
	var tip_loc = to_local(tip)
	links.rotation = self.position.angle_to_point(tip_loc) - deg2rad(90)
	$Tip.rotation = self.position.angle_to_point(tip_loc) - deg2rad(90)
	links.position = tip_loc
	links.region_rect.size.y = tip_loc.length()

func _physics_process(delta : float) -> void:
	$Tip.global_position = tip
	if flying:
		if $Tip.move_and_collide(direction * SPEED):
			hooked = true
			flying = false
	tip = $Tip.global_position
"

[sub_resource type="CapsuleShape2D" id=1]

[node name="Chain" type="Node2D"]
script = SubResource( 2 )

[node name="Links" type="Sprite" parent="."]
position = Vector2( 45, 104 )
scale = Vector2( 3, 7 )
texture = ExtResource( 2 )

[node name="Tip" type="KinematicBody2D" parent="."]
position = Vector2( 3, -2 )
collision_layer = 4

[node name="Hook" type="Sprite" parent="Tip"]
position = Vector2( 3, 46 )
scale = Vector2( 4, 5 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Tip"]
position = Vector2( -3, 2 )
shape = SubResource( 1 )
